include ../common.mk

SHELL:=bash

$(TARGET):
	mkdir -p $(BUILD_DIR)/full && \
	mkapp ipc.adef -v -t $@ -i interfaces/hello -w $(BUILD_DIR)/full -o $(BUILD_DIR)/full
	mkdir -p $(BUILD_DIR)/code && \
	mkapp --generate-code ipc.adef -v -t $@ -i interfaces/hello \
	    -w $(BUILD_DIR)/code -o $(BUILD_DIR)/code
	diff -U0 <(find $(BUILD_DIR)/full -name '*.[ch]' |sed "s!^$(BUILD_DIR)/full!!" |sort) \
                 <(find $(BUILD_DIR)/code -name '*.[ch]' |sed "s!^$(BUILD_DIR)/code!!" |sort) || \
	echo >&2 "error: Code files generated by full build and gen-code build differs."
